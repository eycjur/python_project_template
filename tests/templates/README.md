# テストテンプレート集

このディレクトリには、よく使用されるテストパターンのテンプレートが含まれています。

## 概要

モックを使用したテストや、pytest の様々な機能を活用したテストのテンプレートを提供します。実際のテストを作成する際に、これらのテンプレートをコピーして修正することで、効率的にテストを書くことができます。

## ファイル一覧

### 1. `test_repository_mock_template.py`
- **目的**: リポジトリクラスのモックテスト
- **主な内容**:
  - リポジトリインターフェースのモック化
  - モックメソッドの戻り値設定
  - メソッド呼び出しの検証
  - 例外処理のテスト
  - `@patch` デコレータの使用例

### 2. `test_usecase_mock_template.py`
- **目的**: ユースケースクラスの依存関係をモックしたテスト
- **主な内容**:
  - 依存性注入を使ったユースケースのテスト
  - モックリポジトリを使った分離テスト
  - パラメータ化テストの例
  - 例外伝播のテスト

### 3. `fixtures_template.py`
- **目的**: pytest フィクスチャのテンプレート集
- **主な内容**:
  - 基本的なテストデータフィクスチャ
  - モック関連のフィクスチャ
  - 依存性注入関連のフィクスチャ
  - FastAPI テストクライアントのフィクスチャ
  - パラメータ化フィクスチャ
  - セットアップ・ティアダウンフィクスチャ

### 4. `test_utils_template.py`
- **目的**: テストで頻繁に使用されるユーティリティ関数
- **主な内容**:
  - アサーション関数
  - テストデータ生成関数
  - HTTP レスポンス検証関数
  - 例外テスト用ヘルパー
  - パフォーマンステスト用関数
  - テスト環境セットアップ関数

### 5. `test_parametrized_template.py`
- **目的**: `@pytest.mark.parametrize` を使ったパラメータ化テストの例
- **主な内容**:
  - 基本的なパラメータ化テスト
  - 複数パラメータの組み合わせ
  - 例外ケースのパラメータ化
  - 名前付きパラメータ（`pytest.param` with `id`）
  - 条件付きスキップ
  - 複雑なテストデータのパラメータ化

### 6. `test_integration_template.py`
- **目的**: 依存性注入を使った統合テスト
- **主な内容**:
  - 実際の TestModule を使用した統合テスト
  - 部分的にモックを使用した統合テスト
  - エラーケースの統合テスト
  - パフォーマンステスト
  - 分離されたテスト環境の作成

## 使用方法

1. **テンプレートの選択**: 作成したいテストの種類に応じて適切なテンプレートを選択
2. **ファイルのコピー**: テンプレートファイルを適切なテストディレクトリにコピー
3. **内容の修正**: プロジェクトの構造に合わせてインポート文やクラス名を修正
4. **テストケースの調整**: 実際のテスト要件に合わせてテストケースを調整

## 具体的な使用例

### リポジトリのモックテストを作成したい場合

```python
# tests/unit/infrastructure/test_my_repository.py

from tests.templates.test_repository_mock_template import TestRepositoryMockTemplate
from app.infrastructure.repository.my_repository import MyRepository

class TestMyRepository(TestRepositoryMockTemplate):
    # テンプレートのメソッドをそのまま使用するか、
    # 必要に応じてオーバーライドする
    pass
```

### ユースケースのテストを作成したい場合

```python
# tests/unit/usecase/test_my_usecase.py

from tests.templates.test_usecase_mock_template import TestUsecaseMockTemplate
from app.usecase.my_usecase import MyUsecase

class TestMyUsecase(TestUsecaseMockTemplate):
    # 必要な部分をテンプレートからコピーして使用
    pass
```

## 注意点

- **テンプレートのまま使用しない**: これらはテンプレートなので、実際のプロジェクト構造に合わせて修正が必要
- **インポート文の調整**: プロジェクトのパッケージ構造に合わせてインポート文を修正
- **フィクスチャの依存関係**: `conftest.py` に必要なフィクスチャが定義されているか確認
- **テストの命名**: テストメソッド名は実際のテスト内容を反映するように変更

## ベストプラクティス

1. **1つのテストは1つの関心事をテストする**
2. **テストメソッド名は何をテストしているかを明確にする**
3. **Arrange-Act-Assert パターンに従う**
4. **モックは必要最小限に留める**
5. **テストデータは意味のある値を使用する**
6. **例外ケースも忘れずにテストする**

## 拡張方法

新しいテストパターンが必要になった場合は、既存のテンプレートを参考にして新しいテンプレートファイルを作成し、このREADMEにも追加してください。